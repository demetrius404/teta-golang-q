# Q16

## Вопрос
Что такое stack и heap? (1)

`Стек` (`stack`) — это область оперативной памяти, которая создаётся для каждого потока(2). Он работает в порядке LIFO (Last In, First Out), то есть последний добавленный в стек кусок памяти будет первым в очереди на вывод из `стека`.
Как правило, размер `стека` имеет фиксированое значение, в результате чего при превышении лимита памяти, выделенной на `стек`, произойдёт переполнение. 

`Куча` (`heap`) — это область памяти, также расположенное в ОЗУ, которое допускает динамическое выделение памяти. По сути `куча` хранилище переменных / структур / объектов (3) и т.п. во время выполнения. По завершении работы все выделенные участки освобождаются.

## Про Golang

Место хранения, выбранное реализацией, не имеет отношения к семантике языка.

Когда это возможно, компилятор `Golang` будут выделять переменные, которые локальны для функции в кадре стека (`stack frame`) этой функции. Однако если компилятор не может определить, что на переменную не ссылаются после того как функция выполняет возврат, то компилятор должен разместить переменную в куче (`heap`), проверяемой сборщиком мусора. Кроме того, если локальная переменная "большая", тогда она может храниться ее в куче.

Ссылка на FAQ:
[How do I know whether a variable is allocated on the heap or the stack?](https://go.dev/doc/faq#stack_or_heap)

> где не рекомендуют задаваться этим вопросом, т.к. всё должно работать достаточно быстро в любом случае.

Используя дополнительные флаг при сборке можно посмотреть 
```
go build -gcflags "-m" main.go
```
- `&v literal escapes to heap` - куча (`heap`)
- `&v literal does not escape` - стек (`stack`)

---
Примечения:
1) Предполагается что речь идет об организации работы с ОЗУ, а не о структурах данных
2) В `Golang` другой контекст
3) Зависит от контекста (не всех и не всегда)

Хорошая статья: [Визуализация управления памятью в Golang](https://russianblogs.com/article/79091180645)